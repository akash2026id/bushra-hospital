<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Queen Ripa üòòüå∏ - AI Chat Bot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', 'Kalpurush', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            opacity: 0.95;
            font-size: 1em;
        }

        .status {
            background: #2ecc71;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            display: inline-block;
            margin-top: 8px;
        }

        .admin-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .admin-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            justify-content: flex-end;
        }

        .bot-message {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 1em;
            line-height: 1.4;
            position: relative;
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        .user-message .message-content {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .bot-message .message-content {
            background: white;
            color: #2c3e50;
            border: 2px solid #e9ecef;
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1em;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .user-avatar {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }

        .bot-avatar {
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            color: white;
        }

        .input-container {
            padding: 15px;
            background: white;
            border-top: 2px solid #f1f3f4;
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        #userInput {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            font-size: 1em;
            outline: none;
            transition: all 0.3s ease;
            background: #f8f9fa;
            resize: none;
            min-height: 50px;
            max-height: 150px;
            overflow-y: auto;
            font-family: inherit;
        }

        #userInput:focus {
            border-color: #ff6b6b;
            background: white;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.3);
        }

        #sendButton {
            padding: 12px 25px;
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
            height: 50px;
        }

        #sendButton:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.6);
        }

        #sendButton:active {
            transform: translateY(0);
        }

        #sendButton:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .typing-indicator {
            display: none;
            padding: 12px 18px;
            background: white;
            border-radius: 18px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
            align-self: flex-start;
            max-width: 150px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .typing-content {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .typing-dots {
            display: flex;
            gap: 3px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #ff6b6b;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        .controls {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .clear-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .clear-btn:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
        }

        .copy-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .copy-btn:hover {
            background: linear-gradient(135deg, #2980b9, #21618c);
        }

        .info-btn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
        }

        .info-btn:hover {
            background: linear-gradient(135deg, #8e44ad, #7d3c98);
        }

        .timestamp {
            font-size: 0.7em;
            opacity: 0.7;
            margin-top: 3px;
            text-align: right;
        }

        .message-actions {
            position: absolute;
            top: -8px;
            right: -8px;
            display: none;
        }

        .message-content:hover .message-actions {
            display: block;
        }

        .copy-message-btn {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 0.7em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .sent-indicator {
            font-size: 0.7em;
            opacity: 0.7;
            margin-top: 2px;
            text-align: right;
            color: #27ae60;
        }

        /* Special content styling */
        .link-box {
            background: #f1f8ff;
            border: 1px solid #c8e1ff;
            border-radius: 8px;
            padding: 10px;
            margin: 5px 0;
            word-break: break-all;
        }

        .link-box a {
            color: #0366d6;
            text-decoration: none;
            font-weight: bold;
        }

        .link-box a:hover {
            text-decoration: underline;
        }

        .code-box {
            background: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 12px;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            position: relative;
            overflow-x: auto;
        }

        .copy-code-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #0366d6;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.7em;
            cursor: pointer;
        }

        .solution-box {
            background: #e8f5e9;
            border: 1px solid #c8e6c9;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            position: relative;
        }

        .solution-title {
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .list-content {
            margin-left: 20px;
        }

        .list-content li {
            margin-bottom: 5px;
        }

        /* Limit Message */
        .limit-message {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
            color: #856404;
        }

        /* Premium Message */
        .premium-message {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .premium-title {
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .premium-number {
            background: #4caf50;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin: 15px 0;
            display: inline-block;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .premium-number:hover {
            background: #388e3c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .premium-note {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
        }

        /* Admin Panel Styles */
        .admin-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            z-index: 1000;
            overflow-y: auto;
        }

        .admin-content {
            background: white;
            width: 90%;
            max-width: 1200px;
            margin: 30px auto;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .admin-header h2 {
            color: #2c3e50;
        }

        .close-admin {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
        }

        .admin-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .admin-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        .admin-tab.active {
            border-bottom-color: #ff6b6b;
            color: #ff6b6b;
            font-weight: bold;
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .user-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 5px;
        }

        .user-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-item:hover {
            background: #f9f9f9;
        }

        .user-item.active {
            background: #e3f2fd;
        }

        .user-actions {
            display: flex;
            gap: 8px;
        }

        .limit-btn, .unlimit-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: bold;
        }

        .limit-btn {
            background: #e74c3c;
            color: white;
        }

        .unlimit-btn {
            background: #2ecc71;
            color: white;
        }

        .user-chat {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 15px;
            background: #f8f9fa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #ff6b6b;
        }

        .stat-label {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        /* Limited Users Section */
        .limited-users-list {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 5px;
        }

        .limited-user-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .limited-user-item:hover {
            background: #f9f9f9;
        }

        .limited-user-info {
            flex: 1;
        }

        .limited-user-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .limited-user-details {
            font-size: 0.8em;
            color: #666;
        }

        .limited-user-actions {
            display: flex;
            gap: 8px;
        }

        /* Name input modal */
        .name-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .name-modal-content {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            text-align: center;
        }

        .name-modal h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        #userNameInput {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 1em;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
        }

        .modal-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .modal-primary {
            background: #ff6b6b;
            color: white;
        }

        .modal-secondary {
            background: #eee;
            color: #333;
        }

        /* Scrollbar Styling */
        .chat-container::-webkit-scrollbar {
            width: 6px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            border-radius: 8px;
        }

        .chat-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        @media (max-width: 768px) {
            .container {
                height: 100vh;
            }
            
            .header h1 {
                font-size: 1.6em;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .avatar {
                width: 35px;
                height: 35px;
                margin: 0 8px;
                font-size: 0.9em;
            }
            
            .input-container {
                padding: 12px;
            }
            
            .admin-content {
                width: 95%;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üëë Queen Ripa üòòüå∏</h1>
            <p>Your Personal AI Assistant</p>
            <div class="status">Created By Mr. Abuhurira üôÉ‚úÖ& Ready</div>
            <button class="admin-btn" onclick="showAdminLogin()">Admin</button>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="message bot-message">
                <div class="avatar bot-avatar">üëë</div>
                <div class="message-content">
                    <strong>Assalamu Alaikum! üòä I'm Queen Ripa üòòüå∏</strong><br>
                    I'm your friendly Muslim AI assistant here to help you with anything you need! Feel free to ask me questions in any language. üíù
                    <div class="timestamp" id="initialTime"></div>
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-content">
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
                <span>Typing...</span>
            </div>
        </div>

        <div class="input-container">
            <textarea id="userInput" placeholder="Type your message here..." autocomplete="off"></textarea>
            <button id="sendButton">üì§ Send</button>
        </div>

        <div class="controls">
            <button class="control-btn clear-btn" onclick="clearChat()">üóëÔ∏è Clear Chat</button>
            <button class="control-btn copy-btn" onclick="copyChat()">üìã Copy Chat</button>
            <button class="control-btn info-btn" onclick="showInfo()">‚ÑπÔ∏è Info</button>
        </div>
    </div>

    <!-- Name Input Modal -->
    <div class="name-modal" id="nameModal">
        <div class="name-modal-content">
            <h3>Welcome to Queen Ripa üòòüå∏</h3>
            <p>Please enter your name to continue chatting:</p>
            <input type="text" id="userNameInput" placeholder="Your name">
            <div class="modal-buttons">
                <button class="modal-btn modal-secondary" onclick="skipName()">Skip</button>
                <button class="modal-btn modal-primary" onclick="saveUserName()">Continue</button>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div class="name-modal" id="adminLoginModal">
        <div class="name-modal-content">
            <h3>Admin Login</h3>
            <p>Enter admin passcode:</p>
            <input type="password" id="adminPasscode" placeholder="Admin passcode">
            <div class="modal-buttons">
                <button class="modal-btn modal-secondary" onclick="closeAdminLogin()">Cancel</button>
                <button class="modal-btn modal-primary" onclick="verifyAdmin()">Login</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-content">
            <div class="admin-header">
                <h2>Admin Panel - Queen Ripa üòòüå∏</h2>
                <button class="close-admin" onclick="closeAdminPanel()">Close</button>
            </div>
            
            <div class="admin-tabs">
                <div class="admin-tab active" onclick="switchAdminTab('users')">Users</div>
                <div class="admin-tab" onclick="switchAdminTab('limited')">Limited Users</div>
                <div class="admin-tab" onclick="switchAdminTab('stats')">Statistics</div>
                <div class="admin-tab" onclick="switchAdminTab('settings')">Settings</div>
            </div>
            
            <div class="admin-section active" id="usersSection">
                <h3>User List</h3>
                <div class="user-list" id="userList">
                    <!-- User list will be populated here -->
                </div>
                <div id="userChatSection" style="display: none; margin-top: 20px;">
                    <h4>Chat History for <span id="selectedUserName"></span></h4>
                    <div class="user-chat" id="userChat">
                        <!-- Selected user's chat will be displayed here -->
                    </div>
                </div>
            </div>
            
            <div class="admin-section" id="limitedSection">
                <h3>Limited Users</h3>
                <p>Users who have reached the message limit:</p>
                <div class="limited-users-list" id="limitedUsersList">
                    <!-- Limited users list will be populated here -->
                </div>
            </div>
            
            <div class="admin-section" id="statsSection">
                <h3>Statistics</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalUsers">0</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="todayUsers">0</div>
                        <div class="stat-label">Today's Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalMessages">0</div>
                        <div class="stat-label">Total Messages</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="todayMessages">0</div>
                        <div class="stat-label">Today's Messages</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="limitedUsers">0</div>
                        <div class="stat-label">Limited Users</div>
                    </div>
                </div>
            </div>
            
            <div class="admin-section" id="settingsSection">
                <h3>Settings</h3>
                <div class="setting-item">
                    <label for="messageLimit">Message Limit per User:</label>
                    <input type="number" id="messageLimit" value="20" min="1" max="100">
                    <button onclick="updateMessageLimit()">Update</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        import { getFirestore, collection, addDoc, getDocs, doc, setDoc, getDoc, onSnapshot, query, orderBy, where, serverTimestamp, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAEckGoJXFWwAbQ7yFVg261EC8DksmgxSY",
            authDomain: "islamic---web.firebaseapp.com",
            projectId: "islamic---web",
            storageBucket: "islamic---web.firebasestorage.app",
            messagingSenderId: "82764871971",
            appId: "1:82764871971:web:1bec96ff6431e94e99b496",
            measurementId: "G-YVV8J8EDRP"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        // Make Firebase available globally
        window.firebaseApp = app;
        window.firebaseDb = db;
        window.firebaseCollection = collection;
        window.firebaseAddDoc = addDoc;
        window.firebaseGetDocs = getDocs;
        window.firebaseDoc = doc;
        window.firebaseSetDoc = setDoc;
        window.firebaseGetDoc = getDoc;
        window.firebaseUpdateDoc = updateDoc;
        window.firebaseOnSnapshot = onSnapshot;
        window.firebaseQuery = query;
        window.firebaseOrderBy = orderBy;
        window.firebaseWhere = where;
        window.firebaseServerTimestamp = serverTimestamp;
    </script>

        <script>
        // Groq API Configuration
        const GROQ_API_KEY = "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";
        const GROQ_API_URL = "https://api.groq.com/openai/v1/chat/completions";

        // DOM Elements
        const chatContainer = document.getElementById('chatContainer');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const nameModal = document.getElementById('nameModal');
        const userNameInput = document.getElementById('userNameInput');
        const adminLoginModal = document.getElementById('adminLoginModal');
        const adminPanel = document.getElementById('adminPanel');

        // App Configuration
        const MESSAGE_LIMIT = 20; // Default message limit per user

        // User data
        let currentUser = {
            id: null,
            name: null,
            ip: null,
            isLimited: false,
            messageCount: 0
        };

        // Chat memory
        let chatHistory = [];

        // Set initial timestamp
        document.getElementById('initialTime').textContent = getCurrentTime();

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user already has a name
            const savedName = localStorage.getItem('userName');
            if (savedName) {
                currentUser.name = savedName;
                currentUser.id = localStorage.getItem('userId') || generateUserId();
                checkUserLimitStatus();
                loadChatHistory();
            } else {
                // Show name input modal
                setTimeout(() => {
                    nameModal.style.display = 'flex';
                }, 1000);
            }

            // Get user IP
            getUserIP().then(ip => {
                currentUser.ip = ip;
            });

            // Auto-resize textarea
            userInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });

            // Focus on input field
            userInput.focus();
        });

        // Event Listeners
        userInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        sendButton.addEventListener('click', sendMessage);

        // User name functions
        function saveUserName() {
            const name = userNameInput.value.trim();
            if (name) {
                currentUser.name = name;
                currentUser.id = generateUserId();
                localStorage.setItem('userName', name);
                localStorage.setItem('userId', currentUser.id);
                nameModal.style.display = 'none';
                saveUserToFirebase();
                checkUserLimitStatus();
                loadChatHistory();
                
                // Ask for name after first message
                addMessageToUI(`Assalamu Alaikum! üòä Nice to meet you, ${name}! üíù I'm Queen Ripa üòòüå∏, your personal AI assistant. How can I help you today? üå∏`, 'bot', false);
            }
        }

        function skipName() {
            currentUser.name = 'Anonymous';
            currentUser.id = generateUserId();
            localStorage.setItem('userName', 'Anonymous');
            localStorage.setItem('userId', currentUser.id);
            nameModal.style.display = 'none';
            saveUserToFirebase();
            checkUserLimitStatus();
            loadChatHistory();
        }

        function generateUserId() {
            return 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
        }

        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error('Error getting IP:', error);
                return 'Unknown';
            }
        }

        // Firebase functions
        async function saveUserToFirebase() {
            if (!window.firebaseDb) return;
            
            try {
                const userRef = window.firebaseDoc(window.firebaseDb, "users", currentUser.id);
                await window.firebaseSetDoc(userRef, {
                    name: currentUser.name,
                    ip: currentUser.ip,
                    firstSeen: window.firebaseServerTimestamp(),
                    lastSeen: window.firebaseServerTimestamp(),
                    isLimited: false,
                    messageCount: 0,
                    limitedAt: null
                });
            } catch (error) {
                console.error("Error saving user to Firebase:", error);
            }
        }

        async function saveMessageToFirebase(message, sender) {
            if (!window.firebaseDb) return;
            
            try {
                await window.firebaseAddDoc(window.firebaseCollection(window.firebaseDb, "messages"), {
                    userId: currentUser.id,
                    userName: currentUser.name,
                    userIp: currentUser.ip,
                    message: message,
                    sender: sender,
                    timestamp: window.firebaseServerTimestamp()
                });

                // Update user's message count
                if (sender === 'user') {
                    await updateUserMessageCount();
                }
            } catch (error) {
                console.error("Error saving message to Firebase:", error);
            }
        }

        async function updateUserMessageCount() {
            if (!window.firebaseDb) return;
            
            try {
                const userRef = window.firebaseDoc(window.firebaseDb, "users", currentUser.id);
                const userDoc = await window.firebaseGetDoc(userRef);
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    const newCount = (userData.messageCount || 0) + 1;
                    
                    await window.firebaseUpdateDoc(userRef, {
                        messageCount: newCount,
                        lastSeen: window.firebaseServerTimestamp()
                    });

                    currentUser.messageCount = newCount;
                    
                    // Check if user reached the limit
                    if (newCount >= MESSAGE_LIMIT && !userData.isLimited) {
                        await limitUser(currentUser.id);
                        currentUser.isLimited = true;
                        showLimitMessage();
                    }
                }
            } catch (error) {
                console.error("Error updating user message count:", error);
            }
        }

        async function limitUser(userId) {
            if (!window.firebaseDb) return;
            
            try {
                const userRef = window.firebaseDoc(window.firebaseDb, "users", userId);
                await window.firebaseUpdateDoc(userRef, {
                    isLimited: true,
                    limitedAt: window.firebaseServerTimestamp()
                });
            } catch (error) {
                console.error("Error limiting user:", error);
            }
        }

        async function unlimitUser(userId) {
            if (!window.firebaseDb) return;
            
            try {
                const userRef = window.firebaseDoc(window.firebaseDb, "users", userId);
                await window.firebaseUpdateDoc(userRef, {
                    isLimited: false,
                    limitedAt: null,
                    messageCount: 0
                });
            } catch (error) {
                console.error("Error unlimiting user:", error);
            }
        }

        async function checkUserLimitStatus() {
            if (!window.firebaseDb) return;
            
            try {
                const userRef = window.firebaseDoc(window.firebaseDb, "users", currentUser.id);
                const userDoc = await window.firebaseGetDoc(userRef);
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    currentUser.isLimited = userData.isLimited || false;
                    currentUser.messageCount = userData.messageCount || 0;
                    
                    if (currentUser.isLimited) {
                        showLimitMessage();
                    }
                }
            } catch (error) {
                console.error("Error checking user limit status:", error);
            }
        }

        async function loadChatHistory() {
            if (!window.firebaseDb) return;
            
            try {
                // Simple query without complex ordering to avoid index issues
                const q = window.firebaseQuery(
                    window.firebaseCollection(window.firebaseDb, "messages"),
                    window.firebaseWhere("userId", "==", currentUser.id)
                );
                
                const querySnapshot = await window.firebaseGetDocs(q);
                const messages = [];
                
                querySnapshot.forEach((doc) => {
                    messages.push(doc.data());
                });
                
                // Sort messages by timestamp locally
                messages.sort((a, b) => {
                    if (a.timestamp && b.timestamp) {
                        return a.timestamp.toDate() - b.timestamp.toDate();
                    }
                    return 0;
                });
                
                // Display messages
                messages.forEach(data => {
                    addMessageToUI(data.message, data.sender, false);
                    chatHistory.push({
                        message: data.message,
                        sender: data.sender,
                        timestamp: data.timestamp
                    });
                });
                
                // Scroll to bottom
                chatContainer.scrollTop = chatContainer.scrollHeight;
            } catch (error) {
                console.error("Error loading chat history:", error);
            }
        }

        // Admin functions
        function showAdminLogin() {
            adminLoginModal.style.display = 'flex';
        }

        function closeAdminLogin() {
            adminLoginModal.style.display = 'none';
        }

        function verifyAdmin() {
            const passcode = document.getElementById('adminPasscode').value;
            if (passcode === 'admin9090') {
                adminLoginModal.style.display = 'none';
                adminPanel.style.display = 'block';
                loadAdminData();
            } else {
                alert('Incorrect passcode!');
            }
        }

        function closeAdminPanel() {
            adminPanel.style.display = 'none';
        }

        function switchAdminTab(tabName) {
            // Hide all sections
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected section and activate tab
            document.getElementById(tabName + 'Section').classList.add('active');
            event.target.classList.add('active');
        }

        async function loadAdminData() {
            if (!window.firebaseDb) return;
            
            try {
                // Load users
                const usersSnapshot = await window.firebaseGetDocs(window.firebaseCollection(window.firebaseDb, "users"));
                const userList = document.getElementById('userList');
                const limitedUsersList = document.getElementById('limitedUsersList');
                userList.innerHTML = '';
                limitedUsersList.innerHTML = '';
                
                let limitedUsersCount = 0;
                
                usersSnapshot.forEach((doc) => {
                    const userData = doc.data();
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    userItem.innerHTML = `
                        <div>
                            <strong>${userData.name}</strong><br>
                            <small>IP: ${userData.ip}</small><br>
                            <small>Messages: ${userData.messageCount || 0}/${MESSAGE_LIMIT}</small>
                        </div>
                        <div class="user-actions">
                            ${userData.isLimited ? 
                                `<button class="unlimit-btn" onclick="toggleUserLimit('${doc.id}', false)">Unlimit</button>` :
                                `<button class="limit-btn" onclick="toggleUserLimit('${doc.id}', true)">Limit</button>`
                            }
                        </div>
                    `;
                    userItem.onclick = () => showUserChat(doc.id, userData.name);
                    userList.appendChild(userItem);
                    
                    // Add to limited users list if limited
                    if (userData.isLimited) {
                        limitedUsersCount++;
                        const limitedUserItem = document.createElement('div');
                        limitedUserItem.className = 'limited-user-item';
                        
                        const limitedAt = userData.limitedAt ? 
                            userData.limitedAt.toDate().toLocaleString() : 
                            'Unknown';
                            
                        limitedUserItem.innerHTML = `
                            <div class="limited-user-info">
                                <div class="limited-user-name">${userData.name}</div>
                                <div class="limited-user-details">
                                    IP: ${userData.ip} | 
                                    Messages: ${userData.messageCount || 0}/${MESSAGE_LIMIT} | 
                                    Limited at: ${limitedAt}
                                </div>
                            </div>
                            <div class="limited-user-actions">
                                <button class="unlimit-btn" onclick="toggleUserLimit('${doc.id}', false)">Unlimit</button>
                            </div>
                        `;
                        limitedUsersList.appendChild(limitedUserItem);
                    }
                });
                
                document.getElementById('totalUsers').textContent = usersSnapshot.size;
                document.getElementById('limitedUsers').textContent = limitedUsersCount;
                
                // Load today's users
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const usersQuery = window.firebaseQuery(
                    window.firebaseCollection(window.firebaseDb, "users")
                );
                
                const usersSnapshotAll = await window.firebaseGetDocs(usersQuery);
                let todayUsersCount = 0;
                
                usersSnapshotAll.forEach((doc) => {
                    const userData = doc.data();
                    if (userData.firstSeen) {
                        const firstSeenDate = userData.firstSeen.toDate();
                        if (firstSeenDate >= today) {
                            todayUsersCount++;
                        }
                    }
                });
                
                document.getElementById('todayUsers').textContent = todayUsersCount;
                
                // Load messages count
                const messagesSnapshot = await window.firebaseGetDocs(window.firebaseCollection(window.firebaseDb, "messages"));
                document.getElementById('totalMessages').textContent = messagesSnapshot.size;
                
                // Load today's messages
                const messagesQuery = window.firebaseQuery(
                    window.firebaseCollection(window.firebaseDb, "messages")
                );
                
                const messagesSnapshotAll = await window.firebaseGetDocs(messagesQuery);
                let todayMessagesCount = 0;
                
                messagesSnapshotAll.forEach((doc) => {
                    const messageData = doc.data();
                    if (messageData.timestamp) {
                        const messageDate = messageData.timestamp.toDate();
                        if (messageDate >= today) {
                            todayMessagesCount++;
                        }
                    }
                });
                
                document.getElementById('todayMessages').textContent = todayMessagesCount;
                
            } catch (error) {
                console.error("Error loading admin data:", error);
            }
        }

        async function toggleUserLimit(userId, limitStatus) {
            if (!window.firebaseDb) return;
            
            try {
                if (limitStatus) {
                    await limitUser(userId);
                } else {
                    await unlimitUser(userId);
                }
                
                // Reload admin data
                loadAdminData();
                
                alert(`User ${limitStatus ? 'limited' : 'unlimited'} successfully!`);
            } catch (error) {
                console.error("Error toggling user limit:", error);
                alert("Error updating user limit!");
            }
        }

        async function showUserChat(userId, userName) {
            if (!window.firebaseDb) return;
            
            try {
                console.log("Loading chat for user:", userId, userName);
                
                document.getElementById('selectedUserName').textContent = userName;
                document.getElementById('userChatSection').style.display = 'block';
                document.getElementById('userChat').innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">Loading chat history...</div>';
                
                // Get ALL messages first (to avoid Firebase index issues)
                const messagesSnapshot = await window.firebaseGetDocs(
                    window.firebaseCollection(window.firebaseDb, "messages")
                );
                
                console.log("Total messages in database:", messagesSnapshot.size);
                
                const messages = [];
                let userMessageCount = 0;
                
                // Filter messages for this specific user
                messagesSnapshot.forEach((doc) => {
                    const messageData = doc.data();
                    if (messageData.userId === userId) {
                        userMessageCount++;
                        messages.push({
                            id: doc.id,
                            ...messageData
                        });
                    }
                });
                
                console.log("Messages found for user:", userMessageCount);
                
                // Sort messages by timestamp
                messages.sort((a, b) => {
                    try {
                        const timeA = a.timestamp ? a.timestamp.toDate().getTime() : 0;
                        const timeB = b.timestamp ? b.timestamp.toDate().getTime() : 0;
                        return timeA - timeB;
                    } catch (error) {
                        return 0;
                    }
                });
                
                const userChat = document.getElementById('userChat');
                userChat.innerHTML = '';
                
                if (messages.length === 0) {
                    userChat.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">No chat history found for this user.</div>';
                    return;
                }
                
                // Display each message
                messages.forEach(data => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message ${data.sender}-message`;
                    
                    const avatar = document.createElement('div');
                    avatar.className = `avatar ${data.sender}-avatar`;
                    avatar.textContent = data.sender === 'user' ? 'üë§' : 'üëë';
                    
                    const messageContent = document.createElement('div');
                    messageContent.className = 'message-content';
                    
                    // Format message text
                    let messageText = data.message || '';
                    messageText = messageText.replace(/\n/g, '<br>');
                    
                    // Add timestamp
                    let timestamp = 'Unknown time';
                    try {
                        if (data.timestamp) {
                            timestamp = data.timestamp.toDate().toLocaleString('en-US', {
                                month: 'short',
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                        }
                    } catch (error) {
                        timestamp = 'Invalid time';
                    }
                    
                    messageContent.innerHTML = `
                        <div>${messageText}</div>
                        <div class="timestamp">${timestamp}</div>
                    `;
                    
                    messageDiv.appendChild(avatar);
                    messageDiv.appendChild(messageContent);
                    userChat.appendChild(messageDiv);
                });
                
                userChat.scrollTop = userChat.scrollHeight;
                
            } catch (error) {
                console.error("Error loading user chat:", error);
                document.getElementById('userChat').innerHTML = 
                    '<div style="text-align: center; padding: 20px; color: #e74c3c;">Error loading chat history: ' + error.message + '</div>';
            }
        }

        function updateMessageLimit() {
            const newLimit = document.getElementById('messageLimit').value;
            if (newLimit && newLimit > 0) {
                alert(`Message limit updated to ${newLimit}`);
                // In a real implementation, you would save this to Firebase
            }
        }

        // Chat functions
        async function sendMessage() {
            if (currentUser.isLimited) {
                showLimitMessage();
                return;
            }

            const message = userInput.value.trim();
            if (!message) return;

            // Add user message with sent indicator
            addMessageToUI(message, 'user', true);
            userInput.value = '';
            userInput.style.height = 'auto';
            sendButton.disabled = true;
            showTyping();

            // Save to chat history
            chatHistory.push({
                message: message,
                sender: 'user',
                timestamp: new Date()
            });

            // Save to Firebase
            saveMessageToFirebase(message, 'user');

            try {
                const response = await callGroqAPI(message);
                hideTyping();
                sendButton.disabled = false;
                
                if (response.choices && response.choices[0]) {
                    const botResponse = response.choices[0].message.content;
                    addMessageToUI(botResponse, 'bot', false);
                    
                    // Save to chat history
                    chatHistory.push({
                        message: botResponse,
                        sender: 'bot',
                        timestamp: new Date()
                    });
                    
                    // Save to Firebase
                    saveMessageToFirebase(botResponse, 'bot');
                } else {
                    throw new Error('Invalid API response');
                }
            } catch (error) {
                hideTyping();
                sendButton.disabled = false;
                console.error('API Error:', error);
                addMessageToUI(`Sorry üòî, there was an error: ${error.message}. Please try again later! üíù`, 'bot', false);
            }
        }

        function showLimitMessage() {
            // Clear any existing limit messages
            const existingLimitMessages = document.querySelectorAll('.limit-message, .premium-message');
            existingLimitMessages.forEach(msg => msg.remove());
            
            const limitDiv = document.createElement('div');
            limitDiv.className = 'limit-message';
            limitDiv.innerHTML = `
                <strong>‚ö†Ô∏è Chat Limit Reached</strong><br>
                ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶π‡¶Ø‡¶º‡ßá ‡¶ó‡ßá‡¶õ‡ßá‡•§ ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ‡¶§‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ üòî<br>
                <small>Your chat limit has been reached. Please try again later.</small>
            `;
            chatContainer.appendChild(limitDiv);
            
            // Add premium message with contact info
            const premiumDiv = document.createElement('div');
            premiumDiv.className = 'premium-message';
            premiumDiv.innerHTML = `
                <div class="premium-title">üíé Premium Upgrade Available</div>
                <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶π‡¶Ø‡¶º‡ßá ‡¶ó‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ø‡¶¶‡¶ø ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶≠‡¶æ‡¶∞‡ßç‡¶∏‡¶® ‡¶®‡¶ø‡¶§‡ßá ‡¶ö‡¶æ‡¶® ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®:</p>
                <a href="tel:01997631047" class="premium-number">üìû 01997631047</a>
                <button class="premium-number" onclick="copyNumber()" style="margin-left: 10px;">üìã Copy Number</button>
                <div class="premium-note">
                    ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®: WhatsApp/IMO/Call<br>
                    Developer: Mr. Abuhurira Akash
                </div>
            `;
            chatContainer.appendChild(premiumDiv);
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function copyNumber() {
            const number = "01997631047";
            copyToClipboard(number);
            showCopyFeedback('Number copied to clipboard!');
        }

        async function callGroqAPI(userMessage) {
            // Prepare conversation history for context
            const messages = [
                {
                    role: "system",
                    content: `You are Queen Ripa üòòüå∏, a friendly Muslim AI assistant. You are designed to be helpful, caring, and professional. 
                    You can communicate in any language the user prefers, including Bengali. 
                    Always respond in a warm and engaging manner with appropriate emojis. You remember the conversation history and context.
                    When users greet you with "Assalamu Alaikum" or "Salam", respond with "Wa Alaikum Assalam" or appropriate Islamic greeting.
                    You can act as a friend, best friend, girlfriend, or wife based on how the user interacts with you.
                    You can discuss various religions respectfully but always maintain your identity as a Muslim assistant.
                    Format your responses nicely with lists, code blocks, and links when appropriate.
                    When providing solutions to problems, use the special solution box format.
                    Always use emojis to make the conversation more lively and engaging.
                    Use emojis in every response to make it more friendly and appealing.`
                }
            ];

            // Add conversation history (last 10 messages for context)
            const recentHistory = chatHistory.slice(-10);
            recentHistory.forEach(msg => {
                messages.push({
                    role: msg.sender === 'user' ? 'user' : 'assistant',
                    content: msg.message
                });
            });

            // Add the current user message
            messages.push({
                role: "user",
                content: userMessage
            });

            const response = await fetch(GROQ_API_URL, {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${GROQ_API_KEY}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    model: "llama-3.1-8b-instant",
                    messages: messages,
                    temperature: 0.7,
                    max_tokens: 1024,
                    stream: false
                })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`);
            }

            return await response.json();
        }

        function addMessageToUI(text, sender, showSent) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const avatar = document.createElement('div');
            avatar.className = `avatar ${sender}-avatar`;
            avatar.textContent = sender === 'user' ? 'üë§' : 'üëë';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            // Process and format the message content
            messageContent.innerHTML = formatMessage(text);
            
            // Add timestamp
            const timestamp = document.createElement('div');
            timestamp.className = 'timestamp';
            timestamp.textContent = getCurrentTime();
            messageContent.appendChild(timestamp);
            
            // Add sent indicator for user messages
            if (showSent && sender === 'user') {
                const sentIndicator = document.createElement('div');
                sentIndicator.className = 'sent-indicator';
                sentIndicator.textContent = '‚úì Sent';
                sentIndicator.title = 'Message sent successfully';
                messageContent.appendChild(sentIndicator);
            }
            
            // Add copy button for bot messages
            if (sender === 'bot') {
                const messageActions = document.createElement('div');
                messageActions.className = 'message-actions';
                
                const copyButton = document.createElement('button');
                copyButton.className = 'copy-message-btn';
                copyButton.innerHTML = 'üìã';
                copyButton.title = 'Copy message';
                copyButton.onclick = function() {
                    copyToClipboard(text);
                    showCopyFeedback();
                };
                
                messageActions.appendChild(copyButton);
                messageContent.appendChild(messageActions);
            }
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            chatContainer.appendChild(messageDiv);
            
            // Scroll to bottom
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function formatMessage(text) {
            // Convert solution boxes
            let formattedText = text.replace(/SOLUTION:([^]+?)SOLUTION_END/g, 
                '<div class="solution-box"><div class="solution-title">üí° Solution</div>$1</div>');
            
            // Convert URLs to clickable links
            formattedText = formattedText.replace(/(https?:\/\/[^\s]+)/g, '<div class="link-box"><a href="$1" target="_blank">$1</a></div>');
            
            // Convert code blocks
            formattedText = formattedText.replace(/```([^`]+)```/g, '<div class="code-box">$1<button class="copy-code-btn" onclick="copyCode(this)">Copy</button></div>');
            
            // Convert inline code
            formattedText = formattedText.replace(/`([^`]+)`/g, '<code>$1</code>');
            
            // Convert lists (both numbered and bulleted)
            formattedText = formattedText.replace(/(\d+\.\s+.*(?:\n|$))+/g, '<div class="list-content"><ol>$&</ol></div>');
            formattedText = formattedText.replace(/([-*]\s+.*(?:\n|$))+/g, '<div class="list-content"><ul>$&</ul></div>');
            
            // Convert line breaks
            formattedText = formattedText.replace(/\n/g, '<br>');
            
            return formattedText;
        }

        function copyCode(button) {
            const code = button.parentElement.textContent.replace('Copy', '');
            copyToClipboard(code);
            showCopyFeedback('Code copied!');
        }

        function showTyping() {
            typingIndicator.style.display = 'block';
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function hideTyping() {
            typingIndicator.style.display = 'none';
        }

        function clearChat() {
            chatContainer.innerHTML = `
                <div class="message bot-message">
                    <div class="avatar bot-avatar">üëë</div>
                    <div class="message-content">
                        <strong>Chat cleared! üßπ</strong><br>
                        Assalamu Alaikum! üòä I'm Queen Ripa üòòüå∏ How can I help you today? üíù
                        <div class="timestamp">${getCurrentTime()}</div>
                    </div>
                </div>
            `;
            
            // Clear local chat history but keep user info
            chatHistory = [];
        }

        function copyChat() {
            const messages = chatContainer.querySelectorAll('.message-content');
            let chatText = `Chat with Queen Ripa üòòüå∏\n\n`;
            
            messages.forEach(message => {
                const text = message.textContent.replace(/‚úì Sent/g, '').trim();
                const isBot = message.closest('.bot-message');
                const sender = isBot ? 'Queen Ripa üòòüå∏' : 'You';
                chatText += `${sender}: ${text}\n\n`;
            });
            
            copyToClipboard(chatText);
            showCopyFeedback('Full chat copied to clipboard!');
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                console.log('Text copied to clipboard');
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                // Fallback method
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            });
        }

        function showCopyFeedback(message = 'Message copied!') {
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 10px 20px;
                border-radius: 10px;
                z-index: 1000;
                font-size: 0.9em;
            `;
            feedback.textContent = message;
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                document.body.removeChild(feedback);
            }, 2000);
        }

        function showInfo() {
            alert(`üëë Queen Ripa üòòüå∏ - AI Chat Bot\n\n` +
                  `üåü About Me:\n` +
                  `‚Ä¢ Name: Queen Ripa üòòüå∏\n` +
                  `‚Ä¢ AI Assistant powered by Groq\n` +
                  `‚Ä¢ Multilingual support\n` +
                  `‚Ä¢ Muslim-friendly responses\n\n` +
                  `‚ö° Features:\n` +
                  `‚Ä¢ Ultra-fast responses\n` +
                  `‚Ä¢ Message sent indicators\n` +
                  `‚Ä¢ Copy individual messages\n` +
                  `‚Ä¢ Copy full chat history\n` +
                  `‚Ä¢ Link and code formatting\n` +
                  `‚Ä¢ Special solution boxes\n` +
                  `‚Ä¢ Chat history saved\n` +
                  `‚Ä¢ Admin panel for monitoring\n` +
                  `‚Ä¢ User limit management\n` +
                  `‚Ä¢ Clean, modern interface\n\n` +
                  `üíù Always here to help you!`);
        }

        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
        }

        // Keep input field focused but allow clicking elsewhere
        document.addEventListener('click', function(e) {
            if (e.target !== userInput && !e.target.closest('.input-container')) {
                // Don't refocus if clicking outside the input area
                return;
            }
            userInput.focus();
        });
    </script>
</body>
</html>
